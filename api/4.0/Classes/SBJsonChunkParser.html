<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="html/html; charset=utf-8" />
		<title>SBJsonChunkParser Class Reference</title>
		<meta id="xcode-display" name="xcode-display" content="render"/>
		<meta name="viewport" content="width=550" />
		<link rel="stylesheet" type="text/css" href="../css/styles.css" media="all" />
		<link rel="stylesheet" type="text/css" media="print" href="../css/stylesPrint.css" />
		<meta name="generator" content="appledoc 2.0.5 (build 789)" />
	</head>
	<body>
		<header id="top_header">
			<div id="library" class="hideInXcode">
				<h1><a id="libraryTitle" href="../index.html">SBJson </a></h1>
				<a id="developerHome" href="../index.html">Stig Brautaset</a>
			</div>
			
			<div id="title" role="banner">
				<h1 class="hideInXcode">SBJsonChunkParser Class Reference</h1>
			</div>
			<ul id="headerButtons" role="toolbar">
				<li id="toc_button">
					<button aria-label="Show Table of Contents" role="checkbox" class="open" id="table_of_contents"><span class="disclosure"></span>Table of Contents</button>
				</li>
				<li id="jumpto_button" role="navigation">
					<select id="jumpTo">
	<option value="top">Jump To&#133;</option>
	
	<option value="overview">Overview</option>
	
	
	
	
	<option value="tasks">Tasks</option>
	
	
	
	
	
	<option value="properties">Properties</option>
	
	<option value="//api/name/maxDepth">&nbsp;&nbsp;&nbsp;&nbsp;maxDepth</option>
	
	<option value="//api/name/supportManyDocuments">&nbsp;&nbsp;&nbsp;&nbsp;supportManyDocuments</option>
	
	<option value="//api/name/supportPartialDocuments">&nbsp;&nbsp;&nbsp;&nbsp;supportPartialDocuments</option>
	
	
	
	
	
	
	<option value="instance_methods">Instance Methods</option>
	
	<option value="//api/name/initWithBlock:errorHandler:">&nbsp;&nbsp;&nbsp;&nbsp;- initWithBlock:errorHandler:</option>
	
	<option value="//api/name/initWithBlock:processBlock:errorHandler:">&nbsp;&nbsp;&nbsp;&nbsp;- initWithBlock:processBlock:errorHandler:</option>
	
	<option value="//api/name/parse:">&nbsp;&nbsp;&nbsp;&nbsp;- parse:</option>
	
	
	
</select>
				</li>
			</ul>
		</header>
		<nav id="tocContainer" class="isShowingTOC">
			<ul id="toc" role="tree">
				
<li role="treeitem"><span class="nodisclosure"></span><span class="sectionName"><a href="#overview">Overview</a></span></li>




<li role="treeitem" id="task_treeitem"><span class="nodisclosure"></span><span class="sectionName"><a href="#tasks">Tasks</a></span><ul>
	
</ul></li>





<li role="treeitem" class="children"><span class="disclosure"></span><span class="sectionName"><a href="#properties">Properties</a></span><ul>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/maxDepth">maxDepth</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/supportManyDocuments">supportManyDocuments</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/supportPartialDocuments">supportPartialDocuments</a></span></li>
	
</ul></li>





<li role="treeitem" class="children"><span class="disclosure"></span><span class="sectionName"><a href="#instance_methods">Instance Methods</a></span><ul>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/initWithBlock:errorHandler:">initWithBlock:errorHandler:</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/initWithBlock:processBlock:errorHandler:">initWithBlock:processBlock:errorHandler:</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/parse:">parse:</a></span></li>
	
</ul></li>


			</ul>
		</nav>
		<article>
			<div id="contents" class="isShowingTOC" role="main">
				<a title="SBJsonChunkParser Class Reference" name="top"></a>
				<div class="main-navigation navigation-top">
					<ul>
	<li><a href="../index.html">Index</a></li>
	<li><a href="../hierarchy.html">Hierarchy</a></li>
</ul>
				</div>
				<div id="header">
					<div class="section-header">
						<h1 class="title title-header">SBJsonChunkParser Class Reference</h1>
					</div>		
				</div>
				<div id="container">	
					
					<div class="section section-specification"><table cellspacing="0"><tbody>
						<tr>
	<td class="specification-title">Inherits from</td>
	<td class="specification-value">NSObject</td>
</tr><tr>
	<td class="specification-title">Declared in</td>
	<td class="specification-value">SBJsonChunkParser.h</td>
</tr>
						</tbody></table></div>
					
					
					
					
					<div class="section section-overview">
						<a title="Overview" name="overview"></a>
						<h2 class="subtitle subtitle-overview">Overview</h2>
						<p>Parse one or more chunks of JSON data.</p>

<p>Using this class directly you can reduce the apparent latency for each
download/parse cycle of documents over a slow connection. You can start
parsing <em>and return chunks of the parsed document</em> before the entire
document is downloaded.</p>

<p>Using this class is also useful to parse huge documents on disk
bit by bit so you don&rsquo;t have to keep them all in memory.</p>

<p>JSON is mapped to Objective-C types in the following way:</p>

<ul>
<li>null    &ndash;> NSNull</li>
<li>string  &ndash;> NSString</li>
<li>array   &ndash;> NSMutableArray</li>
<li>object  &ndash;> NSMutableDictionary</li>
<li>true    &ndash;> NSNumber&rsquo;s -numberWithBool:YES</li>
<li>false   &ndash;> NSNumber&rsquo;s -numberWithBool:NO</li>
<li>number &ndash;> NSNumber</li>
</ul>


<p>Since Objective-C doesn&rsquo;t have a dedicated class for boolean values,
these turns into NSNumber instances. However, since these are
initialised with the -initWithBool: method they round-trip back to JSON
properly. In other words, they won&rsquo;t silently suddenly become 0 or 1;
they&rsquo;ll be represented as &lsquo;true&rsquo; and &lsquo;false&rsquo; again.</p>

<p>Integers are parsed into either a <code>long long</code> or <code>unsigned long long</code>
type if they fit, else a <code>double</code> is used. All real &amp; exponential numbers
are represented using a <code>double</code>. Previous versions of this library used
an NSDecimalNumber in some cases, but this is no longer the case.</p>

<p>The default behaviour is that your passed-in block is only called once the entire input is parsed.
If you set <a href="#//api/name/supportManyDocuments">supportManyDocuments</a> to YES and your input contains multiple (whitespace limited)
JSON documents your block will be called for each document:</p>

<pre><code> SBJsonChunkParser *parser = [[SBJsonChunkParser alloc] initWithBlock:^(id v) {
    NSLog(@"Found: %@", @([v isKindOfClass:[NSArray class]]));
 } errorHandler: ^(NSError* err) {
    NSLog(@"OOPS: %@", err);
 }];

 parser.supportManyDocuments = YES;

 // Note that this input contains multiple top-level JSON documents
 NSData *json = [@"[]{}[]{}" dataWithEncoding:NSUTF8StringEncoding];
 [parser parse:data];
</code></pre>

<p>The above example will print:</p>

<ul>
<li>Found: YES</li>
<li>Found: NO</li>
<li>Found: YES</li>
<li>Found: NO</li>
</ul>


<p>Often you won&rsquo;t have control over the input you&rsquo;re parsing, so can&rsquo;t make use of
this feature. But, all is not lost: if you are parsing a long array you can get the same effect by
setting <a href="#//api/name/supportPartialDocuments">supportPartialDocuments</a> to YES:</p>

<pre><code> SBJsonChunkParser *parser = [[SBJsonChunkParser alloc] initWithBlock:^(id v) {
    NSLog(@"Found: %@", @([v isKindOfClass:[NSArray class]]));
 } errorHandler: ^(NSError* err) {
    NSLog(@"OOPS: %@", err);
 }];
 parser.supportPartialDocuments = YES;

 // Note that this input contains A SINGLE top-level document
 NSData *json = [@"[[],{},[],{}]" dataWithEncoding:NSUTF8StringEncoding];
 [parser parse:data];
</code></pre>
					</div>
					
					
					
					
					
					<div class="section section-tasks">
						<a title="Tasks" name="tasks"></a>
						<h2 class="subtitle subtitle-tasks">Tasks</h2>
						
						
						
						

						<ul class="task-list">
							<li>
	<span class="tooltip">
		<code><a href="#//api/name/initWithBlock:errorHandler:">&ndash;&nbsp;initWithBlock:errorHandler:</a></code>
		
	</span>
	
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/initWithBlock:processBlock:errorHandler:">&ndash;&nbsp;initWithBlock:processBlock:errorHandler:</a></code>
		
	</span>
	
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/supportManyDocuments">&nbsp;&nbsp;supportManyDocuments</a></code>
		<span class="tooltip"><p>Expect multiple documents separated by whitespace</p></span>
	</span>
	<span class="task-item-suffix">property</span>
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/supportPartialDocuments">&nbsp;&nbsp;supportPartialDocuments</a></code>
		<span class="tooltip"><p>Support partial documents.</p></span>
	</span>
	<span class="task-item-suffix">property</span>
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/maxDepth">&nbsp;&nbsp;maxDepth</a></code>
		<span class="tooltip"><p>The max parse depth</p></span>
	</span>
	<span class="task-item-suffix">property</span>
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/parse:">&ndash;&nbsp;parse:</a></code>
		<span class="tooltip"><p>Parse some JSON</p></span>
	</span>
	
	
</li>
						</ul>
						
					</div>
					
					
					
					
					
					<div class="section section-methods">
						<a title="Properties" name="properties"></a>
						<h2 class="subtitle subtitle-methods">Properties</h2>
						
						<div class="section-method">
	<a name="//api/name/maxDepth" title="maxDepth"></a>
	<h3 class="subsubtitle method-title">maxDepth</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>The max parse depth</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>@property (nonatomic) NSUInteger maxDepth</code></div>

    
	
	
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>If the input is nested deeper than this the parser will halt parsing and return an error.</p>

<p>Defaults to 32.</p>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">SBJsonChunkParser.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/supportManyDocuments" title="supportManyDocuments"></a>
	<h3 class="subsubtitle method-title">supportManyDocuments</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Expect multiple documents separated by whitespace</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>@property (nonatomic) BOOL supportManyDocuments</code></div>

    
	
	
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>Normally the <a href="#//api/name/parse:">parse:</a> method returns SBJsonParserComplete when it&rsquo;s found a complete JSON document.
Attempting to parse any more data at that point is considered an error. (&ldquo;Garbage after JSON&rdquo;.)</p>

<p>If you set this property to true the parser will never return SBJsonParserComplete. Rather,
once an object is completed it will expect another object to immediately follow, separated
only by (optional) whitespace.</p>

<p>If you set this to YES the -parser:found: delegate method will be called once for each document in your input.</p>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">SBJsonChunkParser.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/supportPartialDocuments" title="supportPartialDocuments"></a>
	<h3 class="subsubtitle method-title">supportPartialDocuments</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Support partial documents.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>@property (nonatomic) BOOL supportPartialDocuments</code></div>

    
	
	
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>This is useful for parsing huge JSON documents, or documents coming in over a very slow link.</p>

<p>If you set this to true the outer array will be ignored and -parser:found: is called once
for each item in it.</p>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">SBJsonChunkParser.h</code><br />
	</div>				
	
	
</div>
						
					</div>
					
					
					
					
					
					<div class="section section-methods">
						<a title="Instance Methods" name="instance_methods"></a>
						<h2 class="subtitle subtitle-methods">Instance Methods</h2>
						
						<div class="section-method">
	<a name="//api/name/initWithBlock:errorHandler:" title="initWithBlock:errorHandler:"></a>
	<h3 class="subsubtitle method-title">initWithBlock:errorHandler:</h3>
	
	

	<div class="method-subsection method-declaration"><code>- (id)initWithBlock:(SBValueBlock)<em>block</em> errorHandler:(SBErrorHandlerBlock)<em>eh</em></code></div>

    
</div>
						
						<div class="section-method">
	<a name="//api/name/initWithBlock:processBlock:errorHandler:" title="initWithBlock:processBlock:errorHandler:"></a>
	<h3 class="subsubtitle method-title">initWithBlock:processBlock:errorHandler:</h3>
	
	

	<div class="method-subsection method-declaration"><code>- (id)initWithBlock:(SBValueBlock)<em>block</em> processBlock:(SBProcessBlock)<em>processBlock</em> errorHandler:(SBErrorHandlerBlock)<em>eh</em></code></div>

    
</div>
						
						<div class="section-method">
	<a name="//api/name/parse:" title="parse:"></a>
	<h3 class="subsubtitle method-title">parse:</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Parse some JSON</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (SBJsonParserStatus)parse:(NSData *)<em>data</em></code></div>

    
	
	<div class="method-subsection arguments-section parameters">
		<h4 class="method-subtitle parameter-title">Parameters</h4>
		
		<dl class="argument-def parameter-def">
			<dt><em>data</em></dt>
			<dd><p>An NSData object containing the next chunk of JSON</p>

<p>@return
&ndash; SBJsonParserComplete if a full document was found
&ndash; SBJsonParserWaitingForData if a partial document was found and more data is required to complete it
&ndash; SBJsonParserError if an error occured.</p></dd>
		</dl>
		
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>The JSON is assumed to be UTF8 encoded. This can be a full JSON document, or a part of one.</p>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">SBJsonChunkParser.h</code><br />
	</div>				
	
	
</div>
						
					</div>
					
					
				</div>
				<div class="main-navigation navigation-bottom">
					<ul>
	<li><a href="../index.html">Index</a></li>
	<li><a href="../hierarchy.html">Hierarchy</a></li>
</ul>
				</div>
				<div id="footer">
					<hr />
					<div class="footer-copyright">
						<p><span class="copyright">&copy; 2013 Stig Brautaset. All rights reserved. (Last updated: 2013-11-13)</span><br />
						
						<span class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.0.5 (build 789)</a>.</span></p>
						
					</div>
				</div>
			</div>
		</article>
		<script type="text/javascript">
			function jumpToChange()
			{
				window.location.hash = this.options[this.selectedIndex].value;
			}
			
			function toggleTOC()
			{
				var contents = document.getElementById('contents');
				var tocContainer = document.getElementById('tocContainer');
				
				if (this.getAttribute('class') == 'open')
				{
					this.setAttribute('class', '');
					contents.setAttribute('class', '');
					tocContainer.setAttribute('class', '');
					
					window.name = "hideTOC";
				}
				else
				{
					this.setAttribute('class', 'open');
					contents.setAttribute('class', 'isShowingTOC');
					tocContainer.setAttribute('class', 'isShowingTOC');
					
					window.name = "";
				}
				return false;
			}
			
			function toggleTOCEntryChildren(e)
			{
				e.stopPropagation();
				var currentClass = this.getAttribute('class');
				if (currentClass == 'children') {
					this.setAttribute('class', 'children open');
				}
				else if (currentClass == 'children open') {
					this.setAttribute('class', 'children');
				}
				return false;
			}
			
			function tocEntryClick(e)
			{
				e.stopPropagation();
				return true;
			}
			
			function init()
			{
				var selectElement = document.getElementById('jumpTo');
				selectElement.addEventListener('change', jumpToChange, false);
				
				var tocButton = document.getElementById('table_of_contents');
				tocButton.addEventListener('click', toggleTOC, false);
				
				var taskTreeItem = document.getElementById('task_treeitem');
				if (taskTreeItem.getElementsByTagName('li').length > 0)
				{
					taskTreeItem.setAttribute('class', 'children');
					taskTreeItem.firstChild.setAttribute('class', 'disclosure');
				}
				
				var tocList = document.getElementById('toc');
				
				var tocEntries = tocList.getElementsByTagName('li');
				for (var i = 0; i < tocEntries.length; i++) {
					tocEntries[i].addEventListener('click', toggleTOCEntryChildren, false);
				}
				
				var tocLinks = tocList.getElementsByTagName('a');
				for (var i = 0; i < tocLinks.length; i++) {
					tocLinks[i].addEventListener('click', tocEntryClick, false);
				}
				
				if (window.name == "hideTOC") {
					toggleTOC.call(tocButton);
				}
			}
			
			window.onload = init;
			
			// If showing in Xcode, hide the TOC and Header
			if (navigator.userAgent.match(/xcode/i)) {
				document.getElementById("contents").className = "hideInXcode"
				document.getElementById("tocContainer").className = "hideInXcode"
				document.getElementById("top_header").className = "hideInXcode"
			}
			
		</script>
	</body>
</html>